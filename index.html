<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UAN – UMANG Face Authentication (HR Onboarding)</title>
  <style>
    :root {
      --neumorphic-bg: #E0E5EC;
      --neumorphic-light-shadow: #FFFFFF;
      --neumorphic-dark-shadow: #A7ADBA;
      --text-color-primary: #333;
      --text-color-secondary: #6B7280;
      --accent-color: #6200EE;
      --accent-color-light: #BB86FC;
      --success-color: #4CAF50;
      --warning-color: #EF4444;
      --divider: rgba(0,0,0,.08);
    }
    body {
      font-family: 'Cambria', Georgia, "Times New Roman", Times, serif;
      background-color: #eaf2f8; 
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box;
      color: var(--text-color-primary); overflow-x: hidden;
    }
    .container {
      background-color: var(--neumorphic-bg);
      padding: 30px 40px; border-radius: 20px;
      box-shadow: 8px 8px 15px var(--neumorphic-dark-shadow),
                  -8px -8px 15px var(--neumorphic-light-shadow);
      max-width: 980px; width: 100%;
      transition: all 0.5s ease-in-out; position: relative;
    }
    .company-logo {
      display:block; margin:0 auto 35px auto; max-width:590px; height:auto; border-radius:45px;
      box-shadow: 3px 3px 6px var(--neumorphic-dark-shadow), -3px -3px 6px var(--neumorphic-light-shadow);
    }
    h1 { text-align:center; color:var(--accent-color); font-weight:600; font-size:2.2em; margin:0 0 10px; }
    h2 { color:var(--accent-color); font-weight:600; font-size:1.6em; margin:20px 0 10px; }
    h3 { color:var(--accent-color); font-weight:600; font-size:1.2em; margin:15px 0 5px; }
    .form-section {
      background-color: var(--neumorphic-bg);
      padding: 22px; border-radius: 16px;
      box-shadow: inset 5px 5px 10px var(--neumorphic-dark-shadow),
                  inset -5px -5px 10px var(--neumorphic-light-shadow);
      margin-bottom: 22px;
    }
    .hidden { display:none; }
    .ack { display:flex; align-items:center; gap:10px; margin-top:16px; font-size: 1.1em; }
    .disabled { opacity:.6; cursor:not-allowed; }
    .wizard { margin-top: 10px; }
    .wizard .progress-wrap { display:flex; align-items:center; justify-content:space-between; gap: 12px; margin-bottom: 14px; }
    .wizard .progress-text { font-weight: bold; color: var(--text-color-secondary); }
    .wizard .progress-bar-outer { flex:1; height: 10px; border-radius: 999px; background: #d9e1eb; position: relative; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.08), inset -2px -2px 5px rgba(255,255,255,0.7); }
    .wizard .progress-bar-inner { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-color), var(--accent-color-light)); border-radius: 999px; transition: width .35s ease; box-shadow: 2px 2px 6px rgba(0,0,0,0.15); }
    .section-card { background: var(--neumorphic-bg); border-radius: 18px; padding: 18px; box-shadow: inset 4px 4px 9px var(--neumorphic-dark-shadow), inset -4px -4px 9px var(--neumorphic-light-shadow); border: 1px solid var(--divider); margin: 18px 0 26px; }
    .section-header { display: flex; align-items: center; gap: 12px; padding-bottom: 10px; border-bottom: 1px dashed var(--divider); margin-bottom: 14px; }
    .badge { width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; font-weight: 700; color: white; background: linear-gradient(145deg, var(--accent-color), var(--accent-color-light)); box-shadow: 4px 4px 8px rgba(0,0,0,.15), -2px -2px 6px rgba(255,255,255,.8); flex: 0 0 auto; }
    .section-title { font-size: 1.2em; color: var(--text-color-primary); font-weight: 700; letter-spacing: .2px; }
    .form-group { margin:12px 0; }
    .form-group label { display:block; margin-bottom:6px; font-weight:bold; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 12px; border: none; border-radius: 10px; background-color: var(--neumorphic-bg);
      box-shadow: inset 2px 2px 5px var(--neumorphic-dark-shadow), inset -2px -2px 5px var(--neumorphic-light-shadow);
      color: var(--text-color-primary); font-size: 1em; outline: none; box-sizing: border-box;
    }
    .form-group textarea{ min-height: 110px; resize: vertical; }
    .checkbox-row { display:flex; gap:16px; flex-wrap:wrap; margin: 20px 0; }
    .checkbox-row label { display:flex; align-items:center; gap:8px; }
    
    .ack input[type="checkbox"], .checkbox-row input[type="checkbox"] {
        transform: scale(1.5);
        margin-right: 5px;
        cursor: pointer;
    }

    .nav-buttons { display:flex; gap:12px; justify-content:space-between; margin-top:14px; }
    button {
      padding: 12px 20px; border:none; border-radius:14px; font-weight:bold; cursor:pointer;
      color:white; background: var(--accent-color);
      box-shadow: 6px 6px 12px rgba(0,0,0,0.25), -6px -6px 12px rgba(255,255,255,0.2);
      transition: transform .1s ease;
    }
    button.secondary { background:#6B7280; }
    button.ghost { background: transparent; color: var(--accent-color); border: 1px solid var(--accent-color); }
    button:active { transform: translateY(1px); }
    .hint{color:#555; font-size:.9em; margin-top:6px}
    .error-text { font-size: 0.9em; color: var(--warning-color); margin-top: 6px; display: none; }
    .error-text.show { display: block; }
    .invalid { border:2px solid var(--warning-color) !important; box-shadow: 0 0 0 4px rgba(255,0,0,.12) !important; }
    .thank-you { text-align:center; padding: 40px 20px; }

    /* --- Mobile Responsive Styles --- */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 20px 15px;
      }
      h1 {
        font-size: 1.8em;
      }
      h2 {
        font-size: 1.4em;
      }
      .company-logo {
        max-width: 80%;
      }
      .ack {
        font-size: 1em;
      }
      button {
        padding: 12px 16px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://i.postimg.cc/44S4b7jP/USDC-Theme.jpg" alt="Company Logo" class="company-logo">

    <div id="infoPage" class="form-section">
      <h1>UAN – UMANG Face Authentication</h1>
      <h2>Why mandatory & what's the use?</h2>
      <p>As per the EPFO circular effective <b>01 Aug 2025</b>, new joiners must complete UAN allotment/activation via UMANG using Face Authentication (FAT). This Aadhaar-based process ensures secure identity verification and instant UAN generation with fewer manual errors.</p>
      <p>For official guidelines, please refer to the <a href="https://drive.google.com/file/d/1f8FMWZf3G6uBgNz1q6T3efNY6LWDGaHg/view?usp=sharing" target="_blank" rel="noopener noreferrer">EPFO Circular</a>.</p>
      <h2>How to Install & Use</h2>
      <p>This process requires two separate mobile apps. Watch these video tutorials for a step-by-step guide: 
        <b><a href="https://www.youtube.com/watch?v=8lb2j6dATcU" target="_blank" rel="noopener noreferrer">Video Tutorial 1</a></b> | 
        <b><a href="https://www.youtube.com/watch?v=df4OP44G4N4" target="_blank" rel="noopener noreferrer">Video Tutorial 2</a></b>
      </p>
      <ol style="padding-left: 20px; line-height: 1.6;">
        <li><b>Install UMANG:</b> Download the main <a href="https://play.google.com/store/apps/details?id=in.gov.umang.negd.g2c" target="_blank" rel="noopener noreferrer">UMANG app</a> from the Google Play Store or Apple App Store. This is the primary app you will use.</li>
        <li><b>Install AadhaarFaceRD:</b> This is a support app required for face scanning. Search for and install <a href="https://play.google.com/store/apps/details?id=in.gov.uidai.facerd" target="_blank" rel="noopener noreferrer">"AadhaarFaceRD"</a> from the app store. You do not need to open this app directly; UMANG will use it automatically in the background.</li>
        <li><b>Generate UAN in UMANG:</b>
          <ul style="padding-left: 20px; margin-top: 5px;">
            <li>Open the UMANG app and register if it's the first time.</li>
            <li>In the search bar, type "EPFO" and select the service.</li>
            <li>Choose the option for "UAN Allotment".</li>
            <li>The app will then guide you through Aadhaar OTP verification, followed by face authentication.</li>
          </ul>
        </li>
      </ol>
      <h3>Before you start the form:</h3>
      <ul>
        <li>Ensure both UMANG and AadhaarFaceRD apps are installed on the employee’s phone.</li>
        <li>Confirm the employee’s mobile number is linked with their Aadhaar for OTP and Face Auth.</li>
      </ul>
      <label class="ack"><input type="checkbox" id="ack"> I have read and understood the UAN via UMANG (FAT) requirements.</label>
      <div class="nav-buttons"><span></span><button type="button" id="proceedBtn" class="disabled">Proceed to Form</button></div>
    </div>

    <form id="uanForm" class="hidden wizard" novalidate>
      <div class="progress-wrap">
        <div id="progressText" class="progress-text">Step 1 of 3</div>
        <div class="progress-bar-outer"><div id="progressInner" class="progress-bar-inner"></div></div>
      </div>
      <div id="step1" class="section-card">
        <div class="section-header"><div class="badge">1</div><div class="section-title">Employee Details</div></div>
        <div class="form-group"><label for="fullname">Full Name As per Aadhar</label><input type="text" id="fullname" required></div>
        <div class="form-group"><label for="doj">Date of Joining</label><input type="date" id="doj" required></div>
        <div class="form-group"><label for="mobile">Mobile Number (Aadhaar-linked)</label><input type="tel" id="mobile" inputmode="numeric" placeholder="10-digit mobile" required><div id="mobileError" class="error-text"></div></div>
        <div class="form-group"><label for="aadhaar">Aadhaar Number</label><input type="tel" id="aadhaar" maxlength="12" inputmode="numeric" placeholder="12-digit number" required><div id="aadhaarError" class="error-text"></div></div>
        <div class="form-group"><label for="pan">PAN Number</label><input type="text" id="pan" maxlength="10" placeholder="ABCDE1234F" style="text-transform:uppercase" required><div id="panError" class="error-text"></div></div>
        <div class="form-group"><label for="email">Email</label><input type="email" id="email" required><div id="emailError" class="error-text"></div></div>
        <div class="nav-buttons"><button type="button" class="secondary" id="back1">Back</button><div class="right"><button type="button" id="next1">Next</button></div></div>
      </div>
      <div id="step2" class="section-card hidden">
        <div class="section-header"><div class="badge">2</div><div class="section-title">Select Service</div></div>
        <div class="form-group"><label for="service">Service Type</label><select id="service" required><option value="">-- Select --</option><option value="allotActivate">Service 1 — UAN Allotment & Activation</option><option value="activate">Service 2 — UAN Activation</option><option value="faceAuth">Service 3 — Face Authentication</option></select></div>
        <div class="nav-buttons"><button type="button" class="secondary" id="back2">Back</button><div class="right"><button type="button" id="next2">Next</button></div></div>
      </div>
      <div id="step3" class="section-card hidden">
        <div class="section-header"><div class="badge">3</div><div class="section-title">Confirmation</div></div>
        <div class="checkbox-row">
            <label><input type="checkbox" id="chkMobileLinked"> Mobile linked with Aadhaar</label>
            <label><input type="checkbox" id="chkSmartphone"> Smartphone with camera</label>
            <label><input type="checkbox" id="chkUmang"> UMANG app installed</label>
            <label><input type="checkbox" id="chkFaceRD"> Aadhaar Face RD installed</label>
        </div>
        <div class="form-group"><label for="uan">UAN (if generated)</label><input type="text" id="uan" maxlength="12" placeholder="12-digit UAN"><div id="uanError" class="error-text"></div></div>
        <div class="form-group"><label for="confStatus">Status</label><select id="confStatus" required><option value="">Select…</option><option>Generated successfully</option><option>Pending – Face Auth failed</option><option>Pending – Aadhaar-mobile not linked</option><option>Pending – App/Device issue</option></select><div id="confStatusError" class="error-text">Please select a status.</div></div>
        <div class="form-group"><label for="confNotes">Remark's</label><textarea id="confNotes" placeholder="Any issues faced..."></textarea></div>
        <div class="form-group"><label for="screenshot">Attach screenshot (Any issues or Errors)</label><input id="screenshot" type="file" accept="image/*" /></div>
        <div class="nav-buttons"><button type="button" class="secondary" id="back3">Back</button><div class="right"><button type="submit" id="finishBtn">Save & Finish</button></div></div>
      </div>
    </form>
    <div id="done" class="form-section hidden thank-you">
      <h2>Saved Successfully</h2>
      <p>The form data has been recorded. You can print a summary below.</p>
      <div id="summary"></div>
      <div class="nav-buttons" style="justify-content:center;margin-top:18px">
        <button type="button" id="printBtn" class="ghost">Print / Save as PDF</button>
      </div>
    </div>
  </div>

<script>
  const infoPage = document.getElementById('infoPage');
  const uanForm = document.getElementById('uanForm');
  const done = document.getElementById('done');
  const proceedBtn = document.getElementById('proceedBtn');
  const ack = document.getElementById('ack');
  const finishBtn = document.getElementById('finishBtn');

  // !!! IMPORTANT !!! - THIS URL HAS BEEN UPDATED WITH YOUR NEW LINK
  const scriptURL = 'https://script.google.com/macros/s/AKfycbwVtqx856IxFfbEfXRi3WJzBLKPHu_mn3bY5QFA0owuns1yrIPij6hUxa5JkgtZRlED/exec';

  const steps = [document.getElementById('step1'), document.getElementById('step2'), document.getElementById('step3')];
  const progressText = document.getElementById('progressText');
  const progressInner = document.getElementById('progressInner');
  const mobileInput = document.getElementById('mobile');
  const mobileError = document.getElementById('mobileError');
  const aadhaarInput = document.getElementById('aadhaar');
  const aadhaarError = document.getElementById('aadhaarError');
  const panInput = document.getElementById('pan');
  const panError = document.getElementById('panError');
  const emailInput = document.getElementById('email');
  const emailError = document.getElementById('emailError');
  const serviceSel = document.getElementById('service');
  const uanInput = document.getElementById('uan');
  const uanError = document.getElementById('uanError');
  const confStatus = document.getElementById('confStatus');
  const confStatusError = document.getElementById('confStatusError');
  const printBtn = document.getElementById('printBtn');
  const summaryDiv = document.getElementById('summary');
  const screenshotInput = document.getElementById('screenshot');

  function syncProceed(){ 
    ack.checked ? proceedBtn.classList.remove('disabled') : proceedBtn.classList.add('disabled');
    proceedBtn.disabled = !ack.checked;
  }
  
  proceedBtn.addEventListener('click', ()=>{
    if (proceedBtn.disabled) return;
    infoPage.classList.add('hidden');
    uanForm.classList.remove('hidden');
    setStep(0);
  });

  function setStep(i){
    steps.forEach((s, idx)=> s.classList.toggle('hidden', idx !== i));
    progressText.textContent = `Step ${i+1} of ${steps.length}`;
    progressInner.style.width = `${((i+1)/steps.length)*100}%`;
  }

  function cleanMobile(raw){
    return (raw || '').replace(/\D/g, '').slice(-10);
  }

  function validateField(el, errorEl, msg, validationFn) {
      if (!validationFn(el.value)) {
          el.classList.add('invalid');
          if (errorEl) { errorEl.textContent = msg; errorEl.classList.add('show'); }
          return false;
      }
      el.classList.remove('invalid');
      if (errorEl) errorEl.classList.remove('show');
      return true;
  }

  function validateStep1(){
    let isValid = true;
    isValid &= validateField(document.getElementById('fullname'), null, '', val => val.trim() !== '');
    isValid &= validateField(document.getElementById('doj'), null, '', val => val.trim() !== '');
    mobileInput.value = cleanMobile(mobileInput.value);
    isValid &= validateField(mobileInput, mobileError, 'Enter a valid 10-digit mobile number.', val => /^[6-9]\d{9}$/.test(val));
    isValid &= validateField(aadhaarInput, aadhaarError, 'Enter a valid 12-digit Aadhaar number.', val => /^\d{12}$/.test(val));
    panInput.value = panInput.value.toUpperCase();
    isValid &= validateField(panInput, panError, 'Enter a valid PAN format (e.g., ABCDE1234F).', val => /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(val));
    isValid &= validateField(emailInput, emailError, 'Enter a valid email address.', val => /^\S+@\S+\.\S+$/.test(val));
    return isValid;
  }

  function validateStep2(){
    return validateField(serviceSel, null, '', val => val !== '');
  }
  
  function validateUAN(){
      const val = uanInput.value.trim();
      if (confStatus.value !== 'Generated successfully' && val === '') {
          uanInput.classList.remove('invalid'); uanError.classList.remove('show'); return true;
      }
      return validateField(uanInput, uanError, 'Enter a valid 12-digit UAN.', val => /^\d{12}$/.test(val));
  }

  function validateConfStatus(){
      return validateField(confStatus, confStatusError, 'Please select a status.', val => val !== '');
  }

  ack.addEventListener('change', syncProceed);
  ['input', 'blur'].forEach(evt => {
      mobileInput.addEventListener(evt, () => validateField(mobileInput, mobileError, 'Enter a valid 10-digit mobile number.', val => /^[6-9]\d{9}$/.test(cleanMobile(val))));
      aadhaarInput.addEventListener(evt, () => validateField(aadhaarInput, aadhaarError, 'Enter a valid 12-digit Aadhaar number.', val => /^\d{12}$/.test(val)));
      panInput.addEventListener(evt, () => validateField(panInput, panError, 'Enter a valid PAN format.', val => /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(val.toUpperCase())));
      emailInput.addEventListener(evt, () => validateField(emailInput, emailError, 'Enter a valid email address.', val => /^\S+@\S+\.\S+$/.test(val)));
      uanInput.addEventListener(evt, validateUAN);
  });
  confStatus.addEventListener('change', () => { validateConfStatus(); validateUAN(); });

  document.getElementById('back1').addEventListener('click', () => { infoPage.classList.remove('hidden'); uanForm.classList.add('hidden'); });
  document.getElementById('next1').addEventListener('click', () => { if(validateStep1()) setStep(1); });
  document.getElementById('back2').addEventListener('click', () => setStep(0));
  document.getElementById('next2').addEventListener('click', () => { if(validateStep2()) setStep(2); });
  document.getElementById('back3').addEventListener('click', () => setStep(1));

  uanForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (!validateUAN() || !validateConfStatus()) return;

    finishBtn.disabled = true;
    finishBtn.textContent = 'Saving...';
    
    const formData = {
        FullName: document.getElementById('fullname').value, DOJ: document.getElementById('doj').value,
        Mobile: mobileInput.value, Aadhaar: aadhaarInput.value, PAN: panInput.value,
        Email: emailInput.value, ServiceType: serviceSel.options[serviceSel.selectedIndex].text,
        UAN: uanInput.value || 'N/A', FinalStatus: confStatus.value,
        Notes: document.getElementById('confNotes').value || '—',
        ChecklistMobileLinked: document.getElementById('chkMobileLinked').checked ? 'Yes' : 'No',
        ChecklistSmartphone: document.getElementById('chkSmartphone').checked ? 'Yes' : 'No',
        ChecklistUmangApp: document.getElementById('chkUmang').checked ? 'Yes' : 'No',
        ChecklistFaceRDApp: document.getElementById('chkFaceRD').checked ? 'Yes' : 'No'
    };

    const file = screenshotInput.files[0];
    if (file) {
      if (file.size > 5 * 1024 * 1024) { // 5MB limit
        alert("File is too large. Please upload a file smaller than 5MB.");
        finishBtn.disabled = false; finishBtn.textContent = 'Save & Finish'; return;
      }
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => {
        formData.ScreenshotFile = reader.result;
        formData.ScreenshotName = file.name;
        sendData(formData);
      };
      reader.onerror = () => {
        alert('Error reading file.');
        finishBtn.disabled = false; finishBtn.textContent = 'Save & Finish';
      };
    } else {
        sendData(formData);
    }
  });

  function sendData(formData) {
    fetch(scriptURL, { method: 'POST', body: JSON.stringify(formData)})
      .then(response => response.json())
      .then(data => {
        if (data.result === 'success') {
          showSummary(formData);
        } else { throw new Error(data.message || 'Failed to save data.'); }
      })
      .catch(error => {
        alert('An error occurred: ' + error.message);
        finishBtn.disabled = false;
        finishBtn.textContent = 'Save & Finish';
      });
  }

  function showSummary(data) {
    const summaryHtml = `
      <div class="section-card">
        <div class="section-header"><div class="badge">✓</div><div class="section-title">Submission Summary</div></div>
        <table style="width:100%;border-collapse:collapse;text-align:left;">
          <tbody>
            <tr><td style="padding:6px 0;color:#666;width:150px;">Full Name</td><td><b>${escapeHtml(data.FullName)}</b></td></tr>
            <tr><td style="padding:6px 0;color:#666;">Date of Joining</td><td>${escapeHtml(data.DOJ)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">Mobile</td><td>${escapeHtml(data.Mobile)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">Aadhaar</td><td>${escapeHtml(data.Aadhaar)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">PAN</td><td>${escapeHtml(data.PAN)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">Email</td><td>${escapeHtml(data.Email)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">Service</td><td>${escapeHtml(data.ServiceType)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">UAN</td><td><b>${escapeHtml(data.UAN)}</b></td></tr>
            <tr><td style="padding:6px 0;color:#666;">Final Status</td><td>${escapeHtml(data.FinalStatus)}</td></tr>
          </tbody>
        </table>
        <div style="margin-top:8px"><b>Remark's:</b> ${escapeHtml(data.Notes)}</div>
        <h4 style="margin-top:15px;margin-bottom:5px;">Checklist Summary</h4>
        <table style="width:100%;border-collapse:collapse;text-align:left;">
            <tr><td style="padding:6px 0;color:#666;width:150px;">Mobile Linked</td><td>${escapeHtml(data.ChecklistMobileLinked)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">Smartphone</td><td>${escapeHtml(data.ChecklistSmartphone)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">UMANG App</td><td>${escapeHtml(data.ChecklistUmangApp)}</td></tr>
            <tr><td style="padding:6px 0;color:#666;">AadhaarFaceRD App</td><td>${escapeHtml(data.ChecklistFaceRDApp)}</td></tr>
        </table>
      </div>`;
    summaryDiv.innerHTML = summaryHtml;
    uanForm.classList.add('hidden');
    done.classList.remove('hidden');
  }

  printBtn.addEventListener('click', () => window.print());
  function escapeHtml(str){ return (str||'').replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]||m)); }
  syncProceed();
  setStep(0);
</script>
</body>
</html>```